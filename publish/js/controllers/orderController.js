define(["./controllers","../services/services","../services/orderService","../directives/directives"],function(t){t.controller("orderController",["$rootScope","$scope","$state","$cookies","Msg","orderService",function(t,e,r,i,o,s){function a(t,r){var i={start:10*t,len:10,value:r};s.getOrderList(i).then(function(r){0==r.status?r.result&&r.result.length>0?($("#pager").show(),$("#currentPage").html(t+1),dealWithPage(r.totalnum),e.orderList=r.result):(e.orderList=[],o("无数据",1500)):o(r.msg,1500)},function(t){o(t.msg,1500)})}function n(t,r){s.getFactoryList().then(function(i){if(0==i.status){if(i.data&&i.data.length>0&&(e.factoryList=i.data,t))for(var s=0;s<i.data.length;s++)t==i.data[s].oemfactoryid&&(e[r]=i.data[s])}else o(i.msg,1500)},function(t){o(t.msg,1500)})}function d(t,r){var i={rolename:"SALES"};s.getSalesList(i).then(function(i){if(0==i.status){if(i.userlist&&i.userlist.length>0&&(e.salesList=i.userlist,t))for(var s=0;s<i.userlist.length;s++)t==i.userlist[s].AccountInfo.userid&&(e[r]=i.userlist[s].AccountInfo)}else o(i.msg,1500)},function(t){o(t.msg,1500)})}function c(t,r){e.mtagList=[],s.getMtagList().then(function(i){if(0==i.status){if(i.mtaglist&&i.mtaglist.length>0){for(var s=0;s<i.mtaglist.length;s++)e.mtagList.push({mtag:i.mtaglist[s],status:!1});if(r){if(t)for(var a=0;a<t.length;a++)for(var n in e.mtagList)t[a]==e.mtagList[n].mtag&&(e.mtagList[n].status=!0);e[r]=e.mtagList}}}else o(i.msg,1500)},function(t){o(t.msg,1500)})}function u(){s.getItermCodeList().then(function(t){if(0==t.status){if(t.data&&t.data.length>0){e.itermCodeList=t.data;for(var r=0;r<e.itermCodeList.length;r++)e.itermCodeList[r].status=!1}}else o(t.msg,1500)},function(t){o(t.msg,1500)})}e.factoryList=[],e.salesList=[],e.mtagList=[],e.itermCodeList=[],e.isShowWorkform=!1,a(0),e.search=function(){a(0,e.searchKey)},e.$watch("searchKey",function(){e.search()}),e.beforePage=function(){getBeforePage(a)},e.afterPage=function(){getAfterPage(a)},e.jumpPage=function(){jumpPage(a)},$("#pageIndex").keypress(function(t){13==(t||window.event).which&&e.jumpPage()}),e.addOrder=function(){e.itermcode="",e.orderNum="",e.factory="",e.sales="",e.orderNo="",e.factoryList.length<=0&&n(),e.salesList.length<=0&&d(),e.mtagList.length<=0&&c()},e.selectProduct=function(){e.itermCodeList.length<=0&&u()},e.codeSubmit=function(){for(var t=[],r=0;r<e.itermCodeList.length;r++)e.itermCodeList[r].status&&t.push(e.itermCodeList[r].itermcode);1!=t.length?o("请选择一个产品",1500):(e.itermcode=t[0],$("#proCancel").click())},e.add_submit=function(){for(var t=[],r=0;r<e.mtagList.length;r++)e.mtagList[r].status&&t.push(e.mtagList[r].mtag);var i={productid:"",itermcode:e.itermcode,ordernum:e.orderNum,oemfactoryid:e.factory.oemfactoryid,factoryname:e.factory.oemfactoryname,salesuserid:e.sales.userid,salesusername:e.sales.nickname,orderid:e.orderNo,mtaglist:t};return i.itermcode?i.ordernum?i.orderid?void s.submitOrder(i).then(function(t){0==t.status?(o("添加成功",1500),$("#add_cancel").click(),a(0)):o(t.msg,1500)},function(t){o(t.msg,1500)}):(alert("请输入订单号"),!1):(alert("请输入数量"),!1):(alert("请选择物料编码"),!1)},e.passDelInfo=function(t){e.delId=t},e.confirmDelete=function(){var t={orderid:e.delId};s.deleteOrder(t).then(function(t){0==t.status?(o("删除成功",1500),$("#delCancel").click(),a(0),e.delId=""):o(t.msg,1500)},function(t){o(t.msg,1500)})},e.passDetailInfo=function(t){var r={orderid:t};s.orderDetail(r).then(function(t){0==t.status?(e.orderEditInfo=t.result,n(e.orderEditInfo.oemfactoryid,"orderEditFactory"),d(e.orderEditInfo.salesuserid,"orderEditSales"),c(e.orderEditInfo.mtaglist,"orderEditMtag"),e.orderEditInfo.licensereqid?e.isShowWorkform=!0:e.isShowWorkform=!1):o(t.msg,1500)},function(t){o(t.msg,1500)})},e.update_submit=function(){for(var t=[],r=0;r<e.orderEditMtag.length;r++)e.orderEditMtag[r].status&&t.push(e.orderEditMtag[r].mtag);var i={productid:"",itermcode:e.orderEditInfo.itermcode,ordernum:e.orderEditInfo.ordernum,oemfactoryid:e.orderEditFactory.oemfactoryid,factoryname:e.orderEditFactory.oemfactoryname,salesuserid:e.orderEditSales.userid,salesusername:e.orderEditSales.nickname,orderid:e.orderEditInfo.orderid,mtaglist:t};s.updateOrder(i).then(function(t){0==t.status?(o("更新成功",1500),$("#update_cancel").click(),a(0)):o(t.msg,1500)},function(t){o(t.msg,1500)})}}])});