define(["./controllers","../services/services","../services/orderService","../directives/directives","async!baiduAPI"],function(e){e.controller("dataController",[function(){function e(e){this.init(e)}function n(){a(),setTimeout(n,180)}function a(){l.clearRect(0,0,m,s),l.globalCompositeOperation="lighter";for(var e=0,n=u.length;e<n;++e)u[e]&&u[e].render(e)}function t(e){this._point=e}function i(){u.length=0;for(var n=countrys.concat(cityArray),t=0,i=n.length;t<i;t++){var o=new BMap.Point(n[t].lng,n[t].lat),m=r.pointToOverlayPixel(o),s=new e({x:m.x-c.x,y:m.y-c.y,size:n[t].size,name:n[t].name});u.push(s)}canvas.style.left=c.x+"px",canvas.style.top=c.y+"px",a()}var r=new BMap.Map("map",{minZoom:4,maxZoom:5});if(r.centerAndZoom(new BMap.Point(116.404,39.915),5),r.enableScrollWheelZoom(),document.createElement("canvas").getContext){var o={features:["road","building","water","land"],style:"dark"};r.setMapStyle(o);var m=0,s=0,l=null,u=[],c=null,y=[{name:"Canada",num:40},{name:"Germany",num:1e3},{name:"Japan",num:1e3},{name:"Australia",num:1e3},{name:"South Korea",num:1e3},{name:"North Korea",num:1e3},{name:"Thailand",num:1e3},{name:"China",num:1e3},{name:"Brazil",num:1e3},{name:"Russia",num:1e3},{name:"Mexico",num:1e3},{name:"Poland",num:1e3}],h=[{name:"杭州",num:15},{name:"上海",num:4e3},{name:"重庆",num:2e3},{name:"南昌",num:2e3},{name:"武汉",num:2e3},{name:"郑州",num:2e3},{name:"北京",num:2e3},{name:"广州",num:2e3},{name:"深圳",num:2e3},{name:"成都",num:2e3},{name:"合肥",num:2e3},{name:"西安",num:2e3},{name:"南京",num:2e3},{name:"天津",num:2e3},{name:"青海",num:2e3},{name:"青岛",num:2e3},{name:"济南",num:2e3},{name:"三亚",num:2e3},{name:"珠海",num:2e3}];cityArray=[],countrys=[],canvas=null,e.prototype.init=function(e){this.x=~~e.x,this.y=~~e.y,this.name=e.name,this.initSize(e.size),1==~~(.5+7*Math.random())?this.size=0:this.size=this.maxSize},e.prototype.initSize=function(e){var e=~~e;this.maxSize=e>8?8:e},e.prototype.render=function(e){var n=this;if(!(n.x<0||n.y<0||n.x>m||n.y>s)){l.beginPath();var a=l.createRadialGradient(n.x,n.y,0,n.x,n.y,n.size);a.addColorStop(0,"rgba(7,120,249,1)"),a.addColorStop(1,"rgba(7,120,249,0.3)"),l.fillStyle=a,l.font="14px Microsoft Yahei",l.fillText(n.name,n.x+n.size,n.y,800),l.arc(n.x,n.y,n.size,2*Math.PI,!1),l.fill(),1==~~(.5+7*Math.random())?n.size=0:n.size=n.maxSize}},t.prototype=new BMap.Overlay,t.prototype.initialize=function(e){this._map=e,canvas=this.canvas=document.createElement("canvas"),canvas.style.cssText="position:absolute;right:0;top:0;",l=canvas.getContext("2d");var n=e.getSize();return canvas.width=m=n.width,canvas.height=s=n.height,e.getPanes().labelPane.appendChild(canvas),this.canvas},t.prototype.draw=function(){var e=this._map,n=e.getBounds(),a=n.getSouthWest(),t=n.getNorthEast();c=e.pointToOverlayPixel(new BMap.Point(a.lng,t.lat)),cityArray.length>0&&countrys.length>0&&i()};var p=new t(new BMap.Point(116.407845,39.914101));r.addOverlay(p),function(){for(var e=0;e<y.length;e++)for(var n=y[e],a=0;a<countryArray.length;a++)if(n.name==countryArray[a].name){countrys.push({lng:countryArray[a].longitude,lat:countryArray[a].latitude,size:n.num,name:n.name});break}setTimeout(i,1e3)}(),function(){for(var e=new BMap.Geocoder,n=0;n<h.length;n++){var a=h[n];!function(n){e.getPoint(n.name,function(e){if(e){var a=new BMap.Point(e.lng,e.lat),t={lng:a.lng,lat:a.lat,size:n.num,name:n.name};cityArray.push(t)}})}(a)}}(),n()}else alert("请在chrome、safari、IE8+以上浏览器查看本示例")}])});