define(["./controllers","../services/services","../services/loginService","../directives/directives"],function(e){e.controller("loginController",["$rootScope","$scope","$state","$cookies","loginService","Msg",function(e,s,o,t,n,i){function a(){return s.phone?s.password?(p.sha1Password=hex_sha1(s.password+p.passwordkey),p.postBody={phone:s.phone,password:p.sha1Password},p.md5Token=hex_md5(JSON.stringify(p.postBody)+p.tokenKey),p.header={timestamp:p.timestamp,token:p.md5Token},void n.login(p.postBody,p.header).then(function(s){0==s.status?(e.globals={nickname:s.nickname,userid:s.userid,loginSession:s.loginsession},t.putObject("globals",e.globals,{expires:p.expireDate}),r()):i(s.msg,1500)},function(e){i(e.msg,1500)})):(i("请输入密码",3e3),!1):(i("请输入用户名",3e3),!1)}function r(){n.getGroupId().then(function(e){0==e.status?o.go("lifesystem.subscribe"):i(e.msg,1500)},function(e){i(e.msg,1500)})}e.globals={};var p={timeStamp:"",passwordkey:"4969fj#k23#",tokenKey:"xgx3d*fe3478$ukx",sha1Password:"",postBody:"",header:"",md5Token:"",expireDate:""};p.expireDate=new Date,p.expireDate.setDate(p.expireDate.getDate()+1),s.login=function(){n.getTimeStamp().then(function(e){0==e.status?(p.timeStamp=e.timestamp,a()):i(e.msg,3e3)},function(e){i(e.msg,3e3)})}}])});