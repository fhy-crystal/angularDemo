define(["./controllers","../services/services","../services/loginService","../directives/directives"],function(e){e.controller("loginController",["$rootScope","$scope","$state","$cookies","loginService","Msg",function(e,s,o,t,i,n){function a(){return s.phone?s.password?(p.sha1Password=hex_sha1(s.password+p.passwordkey),p.postBody={phone:s.phone,password:p.sha1Password},p.md5Token=hex_md5(JSON.stringify(p.postBody)+p.tokenKey),p.header={timestamp:p.timestamp,token:p.md5Token},void i.login(p.postBody,p.header).then(function(s){0==s.status?(e.globals={nickname:s.nickname,userid:s.userid,loginSession:s.loginsession},t.putObject("globals",e.globals,{expires:p.expireDate}),r()):n(s.msg,1500)},function(e){n(e.msg,1500)})):(n("请输入密码",3e3),!1):(n("请输入用户名",3e3),!1)}function r(){i.getGroupId().then(function(s){0==s.status?(e.globals.groupId=s.data.groupid,e.globals.groupType=s.data.grouptype,t.putObject("globals",e.globals,{expires:p.expireDate}),o.go("lifesystem.subscribe")):n(s.msg,1500)},function(e){n(e.msg,1500)})}e.globals={};var p={timeStamp:"",passwordkey:"4969fj#k23#",tokenKey:"xgx3d*fe3478$ukx",sha1Password:"",postBody:"",header:"",md5Token:"",expireDate:""};p.expireDate=new Date,p.expireDate.setDate(p.expireDate.getDate()+1),s.login=function(){i.getTimeStamp().then(function(e){0==e.status?(p.timeStamp=e.timestamp,a()):n(e.msg,3e3)},function(e){n(e.msg,3e3)})},$(".psw").keypress(function(e){13==(e||window.event).which&&s.login()})}])});